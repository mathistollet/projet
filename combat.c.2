#include "projet.h"

void combat3v3(Champion* tousLesChampions, int nbChampions, Champion* equipe1, Champion* equipe2, char* nomEquipe1, char* nomEquipe2) {
    printf("\n--- ");
    printCouleur(nomEquipe1, "\033[0;34m");
    printf("  ---\n");
    for (int i = 0; i < 3; i++) {
        afficherChampion(&equipe1[i], i + 1);
    }
    printf("\n--- ");
    printCouleur(nomEquipe2, "\033[0;31m");
    printf(" ---\n");
    for (int i = 0; i < 3; i++) {
        afficherChampion(&equipe2[i], i + 1);
    }
    printf("\n\n");
    debutc();
    sleep(2);
    printf("\n\n");

    int equipe1vivants = 3;
    int equipe2vivants = 3;
    Champion* cible;

    while (equipe1vivants > 0 && equipe2vivants > 0) {
        for (int i = 0; i < 3; i++) {
            equipe1[i].barre_action += equipe1[i].vitess;
            equipe2[i].barre_action += equipe2[i].vitess;
        }

        for (int j = 0; j < 3; j++) {
            if (equipe1[j].barre_action >= 100 && equipe1[j].pvc > 0) {
                equipe1[j].barre_action = 100;

                printf("== Tour de %s ==\n", equipe1[j].nom);
                if (j == 0) {
                    rayman();
                } else if (j == 1) {
                    boo();
                } else if (j == 2) {
                    groot();
                }
                sleep(1);

                cible = selectionnerCible(&equipe2[0], &equipe2[1], &equipe2[2], &equipe1[j]);
                equipe1[j].barre_action = 0;

                printf("---ETAT DES COMBATTANTS---\n\n");
                printf("equipe ");
                printCouleur(nomEquipe1, "\033[0;34m");
                printf("\n");
                for (int k = 0; k < 3; k++) {
                    if (equipe1[k].pvc > 0) {
                        afficherVie(equipe1[k]);
                        printf(" ");
                        if (equipe1[k].tours_effet_restant != 0) {
                            printf("effet restant encore %d tour", equipe1[k].tours_effet_restant);
                        }
                        printf("\n");
                    }
                }
                printf("\n");
                vs();
                printf("\n");
                printf("equipe ");
                printCouleur(nomEquipe2, "\033[0;31m");
                printf("\n ");
                for (int k = 0; k < 3; k++) {
                    if (equipe2[k].pvc > 0) {
                        afficherVie(equipe2[k]);
                        printf(" ");
                        if (equipe2[k].tours_effet_restant != 0) {
                            printf("effet restant encore %d tour", equipe2[k].tours_effet_restant);
                        }
                        printf("\n");
                    }
                }
                printf("\nappuyez deux fois sur entrer pour passer\n");
                vider();
                getchar();
            }

            if (equipe2[j].barre_action >= 100 && equipe2[j].pvc > 0) {
                equipe2[j].barre_action = 100;
                printf("== Tour de %s ==\n", equipe2[j].nom);

                if (j == 0) {
                    yoda();
                } else if (j == 1) {
                    yoshi();
                } else {
                    toad();
                }
                sleep(1);

                cible = selectionnerCible(&equipe1[0], &equipe1[1], &equipe1[2], &equipe2[j]);
                equipe2[j].barre_action = 0;

                printf("---ETAT DES COMBATTANTS---\n");
                printf("equipe ");
                printCouleur(nomEquipe1, "\033[0;34m");
                printf("\n");
                for (int k = 0; k < 3; k++) {
                    if (equipe1[k].pvc > 0) {
                        afficherVie(equipe1[k]);
                        printf(" ");
                        if (equipe1[k].tours_effet_restant != 0) {
                            printf("effet restant encore %d tour", equipe1[k].tours_effet_restant);
                        }
                        printf("\n");
                    }
                }
                printf("\n");
                vs();
                printf("\n");
                printf("equipe ");
                printCouleur(nomEquipe2, "\033[0;31m");
                printf("\n ");
                for (int k = 0; k < 3; k++) {
                    if (equipe2[k].pvc > 0) {
                        afficherVie(equipe2[k]);
                        printf(" ");
                        if (equipe2[k].tours_effet_restant != 0) {
                            printf("effet restant encore %d tour", equipe2[k].tours_effet_restant);
                        }
                        printf("\n");
                    }
                }
                printf("\nappuyez deux fois sur entrer pour passer...\n");
                vider();
                getchar();

                equipe1vivants = 0;
                equipe2vivants = 0;

                for (int i = 0; i < 3; i++) {
                    if (equipe1[i].pvc > 0) {
                        equipe1vivants++;
                    }
                    if (equipe2[i].pvc > 0) {
                        equipe2vivants++;
                    }
                }
            }
        }

        if (equipe1vivants == 0) {
            printf("Après une bataille épique, l'équipe ");
            printCouleur(nomEquipe2, "\033[0;34m");
            printf(" remporte la victoire !\n");
        } else if (equipe2vivants == 0) {
            printf("Après une bataille épique, l'équipe ");
            printCouleur(nomEquipe1, "\033[0;31m");
            printf(" remporte la victoire !\n");
        }
    }
}
